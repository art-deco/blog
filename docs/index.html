<!doctype html>
<html class="no-js b-Op" lang="en">
  <head>
    <meta charset="utf-8">
    <title>Blog</title>
    <meta content="The 150-160 characters search engine meta:description" name="description">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link sizes="57x57" rel="apple-touch-icon" href="/blog/img/favicon-57.png">
  <link sizes="76x76" rel="apple-touch-icon" href="/blog/img/favicon-76.png">
  <link sizes="120x120" rel="apple-touch-icon" href="/blog/img/favicon-120.png">
  <link sizes="152x152" rel="apple-touch-icon" href="/blog/img/favicon-152.png">
  <link sizes="167x167" rel="apple-touch-icon" href="/blog/img/favicon-167.png">
  <link sizes="180x180" rel="apple-touch-icon" href="/blog/img/favicon-180.png">
  <link sizes="192x192" rel="icon" href="/blog/img/favicon-192.png">
  <link sizes="128x128" rel="icon" href="/blog/img/favicon-128.png">
  <link sizes="32x32" rel="icon" href="/blog/img/favicon-32.png">
  <link
    href="https://fonts.googleapis.com/css?display=swap&amp;family=Ruda%3A400%2C700%7CGreat%20Vibes" rel="preload" as="fetch" crossOrigin>
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin>
    <link href="https://fonts.googleapis.com/css?family=Source%20Code%20Pro" rel="preload" as="style">
    <script>
      (function(b){var a=document.createElement("link");a.href=b;a.rel="stylesheet";a.crossOrigin="crossorigin";document.head.appendChild(a)})('https://fonts.googleapis.com/css?family=Source%20Code%20Pro')
    </script>
    <style id="cpt">
      
        h1 { font-family: 'Great Vibes' }
    
      @font-face {
        font-family: 'Great Vibes';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: local('Great Vibes'), local('GreatVibes-Regular'), url('data:application/font-woff2;base64,d09GMgABAAAAAAV4AA4AAAAACFQAAAUkAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhYbIBwqBmAATBEICocYhi0LDAABNgIkAxQEIAWDegcgG+gGyMQo2qweJMLeecSLkDhEHdGIIhERznz5d/bEuORcc+8n4r9kX1zBgGvygz1gJID+fS4iNLJJZ7NhlciEbKJTsS1S8JdrGWYn9SAAJsGI8EBUmyB4DYgQgjAQtbbUCC8IWgNuN0u12GjEgrfflMG2ucMIYIA+80gYWQshwDvHswNYGVWR95GKf+aLCj29LDePhiXGdJYMemBdNHsO5BBLZvCrXVaJ4teQdWLbhrkjtfxIMyYGb8O9AB+AD/h6zgcCZG/N6jVlD5TowSBGNmRkPe6L7q3uUbeDrdu1BMTtxlSyCQNClPEGSJHm2MpwhEQ2/sS/hVcdKlJPi/eO911Cy1kjK7JHT5hZkd28xSa9SDFOZ9RFjuNqLBN2I2t8BNq0n7l5cdxGOXzBGk+JtBPEZuEsHGM6+gbjy2w85eM0HadlJ1nj7TJnJ2PhiM18YOKOny2Gcd7kpFeJzcx+Zsx3mva3T9yxn6N9j1NMrZ3YLJzlbgwHid/JSlZ754/EclV3kGJyHPTYJr8dIrvxnOwSHeWgGI7be/Cg/3baePHq+PjoKGgfltWzLGumKYaTXrRcTUtnS0+FbOS2baOPUwxnGfV1bDw2duzQMZ9T9jNbbMFbX/HnOE56kWJCHaCTWSPHcTaRnWWNDQxoGVu5mWKkR8e3jo9So6B9fDZuHBs7NHbIZ5/IHn9OZCe2JI4z2NlklqYY6Rayk2IO0z5Hk16xyT+6lEPnaFrDdH7qwNnbZg4mt+uHnwrTtSb2ZcnjVf4dGUvONI1p1w+9sjpbXj75wqyAreKaTlmWQev7XHTodwZf0dpJRKRXRj0bl90X2aXJV7YNnQ9qmHSz2/eNnZ7wGNTlPC/Jk/9aYrpsS1Xwfu0oS20Ks5YVGVUV1eY4V2PI09kzL80sE1rLoy9cljWPx6brp08YKmqsibZJ4ZrCuVnOgtyIFY3aFlB5zWVyc6ohfnaUfFFgSf2MgFNUjm5Nhtxs6v7yB8H0hOP/zTh5z/daaIbCYBinFLntnv7qwtzW34deUi1d5FP6qKMvoOGJlzBaWp9bGeOvqn/2xa6VOdEpofrwWXSyXJUs3Zrx9w8/lmP4nOuINN0vUtUaVbysXdUYT/cLLt2MKgwaDuAlSfl+1carue1kZri/VegtmWO6MH8wt6Zje+JwrKcoq7z5XmgpfmgyNMa3BMvn3pIEL/5gx2ux2cK1XvyZTU0NP+xO+NjkWO0X1/c4xtAY3xKqGWy7EGzQ3ZfoGiMCv/kjKCh8Mpnq79X0VDtqAcDb/ZZAwZ+OcPf/xMSbgxC3m2whLSAACJTHP6vPbpma/7sXxf8KAO6O7qgGgLvSGdewa8SjiV8DfI/a3yPNr3GN4KDQ6Rp2hXg0fYUAKeR/9VYwHd7kBfcmsAgnFQhhJISCd77QqXzYUS90/wU8Am/ZdkpHFiHw01XwPEzBA54PLd5bF3TzQgQRCe+BSJL/3SlIJ61QYQRWLMJs9KEHvZgLMWLRgTiIkYpkpCAVYhi1Siu6UAMNne/DXMggRilKoeI65nZF5qCLgIwcbZiLWCKGq7VxkGEyFjQXeiFGNfP4bMxHFzohhhYjGpbOlKMNQ3KvGBLoMBtd09SKYUYf2kXmasKElT2Yh0G0UawaI2SZTRkNElGqdc7DHHSgFwOw5GKOKdZzD24zC8fmoG9rtWKkIBHJzWNiY9q2hOVxmb1zYUUukpC0LC7ZYtVic5A44ftBJGIEs9GDJFRAi9L/v2zuch/FFNgAAAA=') format('woff2');
      }
      
    </style>
    <script>
      (function(){var b=/url\('([\s\S]+?)'\)/.exec(document.head.querySelector("#cpt").textContent);if(b){var a=document.createElement("link");a.rel="preload";a.as="font";a.href=b[1];document.head.appendChild(a)}})()
    </script>
    <script>(function(h,r){var a=Object.keys(h),c=!0;"CSS"in window&&"supports"in CSS?(a=a.reduce(function(k,b){var l=h[b];b=b.split("|");for(var m=!1,d={},f=0;f<b.length;d={a:d.a},f++)if(d.a=b[f],l.map(function(n){return function(e){e=e.split("|");for(var p=!1,g=0;g<e.length;g++){var q=e[g];if(CSS.supports(n.a,q)){p=!0;break}else k.push(n.a+": "+q)}return p}}(d)).filter(Boolean).length==l.length){m=!0;break}m||(c=!1);return k},[]),a.length?c&&console.log("\ud83d\udcbf Browser does not support CSS properties: %s",
a.join("\n "),"but supports alternatives."):console.log("\ud83d\udcbd Browser supports all modern CSS properties.")):(c=!1,console.log("\ud83d\udce0 Browser does not support CSS checks."));c||(a=document.createElement("link"),a.rel="stylesheet",a.href=r,document.head.appendChild(a))})({"border-radius":[".25rem"],"box-shadow":["none"],"flex|-ms-flex":["0 0 25%"],"display":["flex|-ms-flexbox"],"hyphens|-webkit-hyphens|-ms-hyphens":["auto"],"flex-shrink|-ms-flex-negative":["0"],"position":["sticky|-webkit-sticky"],"flex-wrap|-ms-flex-wrap":["wrap"],"box-sizing":["border-box"],"flex-direction|-ms-flex-direction":["column"]}, '/blog/css/combined-prefixes.css')</script>
    <script>
      (function(q,k){function x(a){for(var f=/url\((.+?)\).*?;\s+unicode-range: (.+?);/g,b={},d=[],h;h=f.exec(a);){var r=h[2];d.push({url:h[1],a:r});b[r]=1}b=Object.keys(b).reduce(function(c,e){var g=e.split(/,\s/).map(function(l){return l.replace("U+","\\u").replace("-","-\\u")}).join("").toLowerCase();c[e]=new RegExp("["+g+"]");return c},{});var t=document.body?document.body.textContent:"",y=t?Object.keys(b).reduce(function(c,e){b[e].test(t)&&(c[e]=!0);return c},{}):Object.keys(b).reduce(function(c,
      e){e in k&&(c[e]=!0);return c},{});m=d.filter(function(c){return c.a in y}).map(function(c){return c.url});if(!m.length)return u();var v=document.createDocumentFragment();m.forEach(function(c,e){var g=document.createElement("link");g.href=c;g.rel="preload";g.as="font";var l=e+1;;g.onload=function(){return u(l)};g.setAttribute("crossorigin",!0);v.appendChild(g)});document.head.appendChild(v)}k=void 0===k?{}:k;var n=document.createElement("link");if(function(a,
      f){if(!a||!a.supports)return!1;try{return a.supports(f)}catch(b){return!1}}(n.relList,"preload")){var z=function(a,f,b){b=void 0===b?"":b;;var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(200==d.status?(f(d.responseText)):console.error("Error loading webfont: server responded with code %s at %s",d.status,a))};d.open("GET",a);try{d.send(null)}catch(h){console.error(h)}};
      ;var p;(function(a,f){z(a.href,function(b){p=b;x(p)},"-"+(void 0===f?"link":f))})({href:q},"js");var m=[],w=0,u=function(a){w++;w>=m.length&&(a=document.createElement("style"),a.innerHTML=p,document.head.appendChild(a))}}else n.rel="stylesheet",n.href=q,document.head.appendChild(n)})('https://fonts.googleapis.com/css?display=swap&family=Ruda%3A400%2C700%7CGreat%20Vibes', {"U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD":true})
    </script>
    <link rel="stylesheet" href="/blog/css/combined.css">
    <link rel="preload" as="style" href="/blog/highlight.js/styles/default.css">
    <style>
      .no-js [data-io], .no-js [data-loading], .no-js .ImageHolder { display: none!important }
    </style>
    <noscript>
      <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?display=swap&amp;family=Great%20Vibes&amp;text=Blog">
      <link rel="stylesheet" href="/blog/css/combined-prefixes.css">
      <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?display=swap&amp;family=Ruda%3A400%2C700%7CGreat%20Vibes">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source%20Code%20Pro">
    </noscript>
    <script defer src="/blog/js/polyfill/intersection-observer.js"></script>
    <script defer src="/blog/js/images.js"></script>
    <script crossorigin data-src="/blog/preact/dist/preact.min.js"></script>
    <script crossorigin data-src="/blog/comps/index.js"></script>
    <script>
      document.documentElement.classList.remove("no-js")
    </script>
  </head>
  <body class="b-Mk b-Ol b-Op">
    
    
    <main class="b-Xl" role="main">
      <div class="b-z">
        <div class="b-B">
          <div class="left-column b-hb">
            <div class="b-kC">
            
                <img class="ImageHolder b-t b-vk" sizes="(max-width: 575.8px) 100vw,(max-width: 767.8px) 510px,(max-width: 991.8px) 150px,(max-width: 1199.8px) 210px,255px" alt="@artdeco/blog logo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='2448' height='3264'/%3E">
                <noscript>
                  <picture>
                    <source
                      srcset="img/st-1140.webp 1140w,img/st-768.webp 768w,img/st-576.webp 576w,img/st-319.webp 319w"
                      sizes="(max-width: 575.8px) 100vw,(max-width: 767.8px) 510px,(max-width: 991.8px) 150px,(max-width: 1199.8px) 210px,255px" type="image/webp">
                    <img class="b-t b-vk" onLoad="webploaded(this)" alt="@artdeco/blog logo" src="/blog/img/st-1140.jpg" srcset="img/st-1140.jpg 1140w,img/st-768.jpg 768w,img/st-576.jpg 576w,img/st-319.jpg 319w" sizes="(max-width: 575.8px) 100vw,(max-width: 767.8px) 510px,(max-width: 991.8px) 150px,(max-width: 1199.8px) 210px,255px">
                  </picture>
                </noscript>
              </div>
              <div class="b-kC">
                <a title="Blog About Node.JS Development." class="GitHubBadge" id="cc3eb"
                  href="https://github.com/art-deco/blog">
                  <span class="a">GitHub</span><span class="b" data-stargazers>⭐️ 1</span></a>
                
                
                <a
                  title="Static Web Site Compiler That Uses Closure Compiler For JS Bundling And Closure Stylesheets For CSS optimisations. Supports JSX Syntax To Write Static Elements And Dynamic Preact Components." class="NPMBadge" href="https://www.npmjs.com/package/splendid">
                  <span class="a"><em>Splendid</em></span><span class="b">1.17.1</span></a>
              </div>
              <h3 id="pages">Pages</h3>
            <ul><li class="Active"><a data-file="index" href="/blog/">Blog</a></li></ul>
              <div class="SideBarMenu sidebarshowing b-jr b-zp">
                <div class="a">
                  
                              <span class="b-xq b-Hk" id="c93ef"><span class="b-Hk" style="height:32px" data-loading>Loading sharing buttons...</span><noscript>Please enable JavaScript to Share</noscript></span>
                                
                </div>
                <a id="HideMenu" style="color:grey!important;" href="#">hide menu</a>
                <a id="ShowMenu" style="color:grey!important;" href="#">show menu</a>
              </div>
          </div>
          
          <div class="right-column b-xq b-nb" id="Content">
            
            
            <h1 id="blog">Blog</h1>
            
            <p>This is the main page. Hello world!</p>
            
            <p>Blog About Node.JS Development.</p>
            
            <span id="ceb55">
              Please bear one moment while I add the content
            </span>
            
            <p class="SectionBreak">
              <a title="Back To Top" href="#top">
                <img alt="section break"
                  src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='15'/%3E" data-io>
                <noscript><img alt="section break" src="/blog/section-breaks/0.svg"></noscript></a>
            </p>
            
            <h2 id="22-feb-2020">22 Feb 2020</h2>
            
            <p>Today was pretty intense. Started with wanted to fix failing Appveyor build for <em>Zoroaster</em>. This required looking into masks which were the reason builds were failing. From masks, I investigated forks as I initially thought that preprocessing doesn't get applied to inputs, but it wasn't the case. Instead, I added the <span class="tm">normaliseOutputs</span> option to forks so that outputs are consistent across platforms (replacing <span class="tm">\n</span> with <span class="tm">\r\n</span> on Win).</p>
            
            <p>
              <img class="b-Ik b-t" alt="appveyor screenshot" data-io>
              <noscript><img class="b-Ik b-t" alt="appveyor screenshot" src="/blog/pages/index/img/appveyor.png"></noscript>
            </p>
            
            <p>During working on packages on windows, I cloned my Documentary widgets for the user directory, and the README wasn't compiling as JSX was failing. Therefore, found out about non-working JSX transpilation on Windows, and had to fix it. Pretty crucial so it's really good to keep a secondary Windows system for development just to make sure that the packages are truly cross-platform. JSX was fixed, and merged into ÀLaMode.</p>
            
            <p>A lot of tests in ÀLaMode and masks had to be updated to be cross-platform too. This typically involves normalising forks' outputs and snapshots outputs also. Apveyor by default will clone the repo using <span class="tm">input</span> crln, but my config is <span class="tm">auto</span> therefore the tests were failing for <em>Zoroaster</em>, as mask results are extracted using EOL which isn't robust. For now, the <span class="tm2">auto</span> strategy is good enough, but when <span class="tm">\n</span> is encountered on Win, instead of <span class="tm">\r\n</span>, mask will fail.</p>
            
            <p>
              <img class="b-Ik b-t" alt="appveyor badge" data-io>
              <noscript><img class="b-Ik b-t" alt="appveyor badge" src="/blog/pages/index/img/badge.png"></noscript>
            </p>
            
            <p>Discovered a bug with FindPackageJSON also, which traverses paths up to root to find the location of a package. This was getting stuck in an infinite loop as the root was assumed to be <span class="tm">/</span> which is wrong on Win (e.g., <span class="tm">C:\</span> is expected instead). This made <em>Documentary</em> as well as <em>Depack</em> freeze without any error message which isn't great. There's a very large number of Windows users therefore testing software on Win is absolutely essential. Just a few weeks ago, I was still using Node 8 and most of my packages were not working on Node 12 :facepalm: It was due to the Node's API being changes so that some functions were not accepting as many args as documented, whereas my package <span class="tm">makepromise</span> was checking if too many arguments were passed, and "Function doesn't accept that many arguments" were thrown A LOT. That probably alienated some people from using packages, and I learned a lesson: to setup CI for Windows + test matrix for Node 8 + 12. Even if <em>I</em> stay on Node 8 on Mac, there are people who run Node 12 on Win.</p>
            
            <p>It's been known that <span class="tm">console.log</span> prints a <span class="tm">\n</span> and not <em>EOL</em> after the logged string. But another interesting observation is that template strings also always print <span class="tm">\n</span> regardless of the platform:</p>
            
            <pre id="ccdbf1"><code class="javascript hljs">const t = `hello
world`</code></pre>
            
            <p>Counter-intuitive, even if the file is saved on a Windows machine, it the new line here is still <span class="tm">\n</span> and not <span class="tm">\r\n</span>. +1 to interview questions list ;)</p>
            
            <p>A lot of time today was spent on testing readline interface as well as forks can accept inputs, and the way I was testing it before, was just by writing questions to <span class="tm">process.stdout</span> and then pushing answers to <span class="tm">process.stdin</span>. That was totally fine on Mac, but on Windows, it's buggy. You need to create separate readable and writable streams for each new question, otherwise Node will freeze if trying to do this through the main process's streams. It can work one time but then stop working for all next times when asking questions. I've updated <span class="tm2">reloquent</span> so that a question now extends <em>ReadlineOptions</em> which means that for testing, I can be passing new streams, e.g.,</p>
            
            <pre id="ccdbf"><code class="javascript hljs">import { askSingle } from 'reloquent'
const output = new Catchment()
const q = askSingle({
  text: 'My girl, Where did you sleep last night',
  output,
  input: new Readable({
    read() {
      this.push('in the pines \n') // =&gt; answer
      this.push(null)
    },
  })
})

output.promise // =&gt; My girl, Where did you sleep last night</code></pre>
            
            <p>This also unloads logging from the main console when writing tests. A disadvantage is that if my API for <span class="tm2">reloquent</span> supported a simple string as a question, I'll be passing an object instead so that I'm not covering the string feature any more. This can result in errors. So it's good to have another tests covering simple strings, but it's impossible... The solution is to create a fork and write to its stdin via a separate process. This will ensure 100% test coverage. Likely with Zoroaster's mask testing it's really easy to do. Also <em>Documentary</em>'s forks can be used to combine this feature with documentation generation.</p>
            
            <p>
              <img class="b-Ik b-t" alt="vs code screenshot" data-io>
              <noscript><img class="b-Ik b-t" alt="vs code screenshot" src="/blog/pages/index/img/code.png"></noscript>
            </p>
            
            <h3 id="todo">TODO</h3>
            
            <li><span class="tm">normaliseOutputs</span> to fully replace all newlines, as currently the regex is <span class="tm">[^\r]\n</span> -> EOL but this doesn't work for 2 consecutive new lines like <span class="tm">\r\n\n</span>.</li>
            <li>Update <span class="tm2">temp-context</span> to create cross-platform snapshots, as the paths are written using a system separator which is annoying and requires to update paths manually.</li>
            <li>Handle <span class="tm">\n</span> without <span class="tm">\r</span> on Windows for mask results extraction.</li>
            <li>Fix <em>Documentary</em> and <em>Depack</em> for FPJ on Windows.</li>
            
            <p class="SectionBreak">
              <a title="Back To Top" href="#top">
                <img alt="section break"
                  src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='13'/%3E" data-io>
                <noscript><img alt="section break" src="/blog/section-breaks/1.svg"></noscript></a>
            </p>
          </div>
        </div>
      </div>
    </main>
    <footer class="b-ns">
      &copy; <a href="https://www.artd.eco">Art Deco™</a>, 2020
    </footer>
    <script>(function(){function b(){if(0<c.length){var a=c.shift();a.src=a.getAttribute("data-src");a.removeAttribute("data-src");a.onload=b;a.onerror=function(){console.warn("Could not load script %s",a.src)}}}var c=Array.prototype.slice.call(document.querySelectorAll("script[data-src]"));b()})()</script>
  </body>
</html>