{
  "title": "Blog",
  "content": "\n\n<h1 id=\"blog\">Blog</h1>\n\n<p>This is the main page. Hello world!</p>\n\n<p>Blog About Node.JS Development.</p>\n\n<span id=\"ceb55\">\n  Please bear one moment while I add the content\n</span>\n\n<p class=\"SectionBreak\">\n  <a title=\"Back To Top\" href=\"#top\">\n    <img alt=\"section break\"\n      src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='15'/%3E\" data-io>\n    <noscript><img alt=\"section break\" src=\"/blog/section-breaks/0.svg\"></noscript></a>\n</p>\n\n<h2 id=\"27-feb-2020\">27 Feb 2020</h2>\n\n<p>Exactly one month from my birthday, where I sat at a pub drawing a diagram for photo-uploader.</p>\n\n<p>Really intense day although I don't even know what most of the time went on. Good stuff waka time is here for me for days like that. I started the day off by beginning an article on medium, and writing an intro to the new post, <strong>Node.JS Image Upload Microservice</strong>, it's going to be big and good. Having Idio makes making microservices a bliss, and it's a good business model -- to help startups set up their infrastructure, now we have Akashic.page for email subscriptions and web-pushes, and image upload. There's plenty more to explore, and provide consulting around those. The most amazing thing is that they are made with bespoke Art Deco software. London's calling.</p>\n\n<p>After the article, I got back on to working on the app, but there wasn't much to improve there hence anxiety again, so I needed to upgrade the MNP template for Idio, so that I can talk about using in the article as it's the easiest way to get started with it. This means I had to take bits out of akashic.page and start putting them into the template: types, tests and frontend were updated. I then took out <span class=\"tm\">jsonErrors</span> middleware and made it common in the Idio server itself, to be reused. Found a bug when status code 500 was treated as client error. The chance of finding the error was actually 1% as the condition was <span class=\"tm\">&lt;= 500</span> so I could've put any other code above 500, and it would have passed :P</p>\n\n<div class=\"b-B b-xq\">\n  <div class=\"b-kb\">\n    <img class=\"ImageHolder b-vk b-t\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 767.8px) 510px,(max-width: 991.8px) 240px,(max-width: 1199.8px) 330px,398px\" alt=\"anton\" src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='2448' height='3264'/%3E\">\n    <noscript>\n      <picture>\n        <source\n          srcset=\"pages/index/img/2-1140.webp 1140w,pages/index/img/2-768.webp 768w,pages/index/img/2-576.webp 576w,pages/index/img/2-319.webp 319w\"\n          sizes=\"(max-width: 575.8px) 100vw,(max-width: 767.8px) 510px,(max-width: 991.8px) 240px,(max-width: 1199.8px) 330px,398px\" type=\"image/webp\">\n        <img class=\"b-vk b-t\" onLoad=\"webploaded(this)\" alt=\"anton\" src=\"/blog/pages/index/img/2-1140.JPG\" srcset=\"pages/index/img/2-1140.JPG 1140w,pages/index/img/2-768.JPG 768w,pages/index/img/2-576.JPG 576w,pages/index/img/2-319.JPG 319w\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 767.8px) 510px,(max-width: 991.8px) 240px,(max-width: 1199.8px) 330px,398px\">\n      </picture>\n    </noscript>\n  </div>\n  <div class=\"b-kb\">\n    <p>Mentally I'm just feeling better because I stopped expecting anything from people it's clear they don't even know the meaning of class. I thought that people kind of posses culture turns out only a couple of people develop it. It sounds so fucking vain but how else can I speak about it if it's true. One thing is being stuck about it, another when I can literally feel a lot of passion about it, about nobility and culture. I don't know where it's from but it's the second time I get this euphoric feeling, and it comes after I'm less confused about the state of the world and understand the condition we're in. there's no problem i just kept forgetting and measured everything to my own standard. proper culture is everything, art, museums, music, books. not to say that family guy is not fun. but i don't know, just feeling better when knowing that i'm 5 years ahead of everyone with my work, and i don't have to prove it we'll see in a few years who's a weirdo then. i love down to earth people who could appreciate it and learn from me instead this fascist community who think they have \"culture\". days like this...</p>\n  </div>\n</div>\n\n<p>After Idio, went back to photo uploader. I already wrote some code a few years ago to rotate images based on their exif with CSS, called <span class=\"tm\">vie-orientation-image</span>, which basically creates a container for an image, on which a transform is applied via CSS (but because the bounding box doesn't get rotated, it overflows), which hides the bounding box. But I think this is now possible to do on a canvas, because the upload already draws preview using canvas, to unload memory (a 250px wide photo is much smaller than 2000px which would lag in the browser).</p>\n\n<p>\n  <img class=\"ImageHolder b-t\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 991.8px) 540px,(max-width: 1199.8px) 720px,855px\" alt=\"previews in the uploader\" src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='629' height='272'/%3E\">\n  <noscript>\n    <picture>\n      <source\n        srcset=\"pages/index/img/previews-576.webp 576w,pages/index/img/previews-319.webp 319w,pages/index/img/previews-629.webp 629w\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 991.8px) 540px,(max-width: 1199.8px) 720px,855px\"\n        type=\"image/webp\">\n      <img class=\"b-t\" onLoad=\"webploaded(this)\" alt=\"previews in the uploader\" src=\"/blog/pages/index/img/previews-576.png\" srcset=\"pages/index/img/previews-576.png 576w,pages/index/img/previews-319.png 319w,pages/index/img/previews-629.png 629w\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 991.8px) 540px,(max-width: 1199.8px) 720px,855px\">\n    </picture>\n  </noscript>\n</p>\n\n<p>The front-end app is using Bootstrap, so some classes are set as <span class=\"tm\">btn btn-sm</span>, for example, and additionally I followed the naming convention for capital letters in class names from CSS rules, e.g., <span class=\"tm\">ImageInfo</span>. Therefore, I wanted to implement my old idea to integrate property names to class conversion in the transpiler. The main package that does JSX transpilation is <span class=\"tm\">@idio/jsx</span>, which is then used by:</p>\n\n<ul>\n  <li><em>FrontEnd</em>, for live serving of JSX files from the server: DEVELOPMENT.</li>\n  <li><em>Depack</em>, when transpiling JSX prior to a build: PRODUCTION.</li>\n  <li><em>ÀLaMode</em>, during server-side rendering, and when building components for publishing: DISTRIBUTION.</li>\n</ul>\n\n<p><em>JSX</em> is massive, and is used in every area of web development. I linked frontend and updated class names in the photo-uploader:</p>\n\n<pre id=\"ccdbf3\"><code class=\"javascript hljs\">import { $Added, $Uploading, $Error, $HasInput, $Uploaded } from './styles/photo.css'\n\nrender() {\n  return (&lt;Copy error={error} hasInput={hasInput} processing={processing} src={src} uploaded={uploaded}&gt;\n    &lt;div Image position-relative w-100 h-100&gt;\n      {!src &amp;&amp;\n        &lt;span PreviewLoadingSpan position-absolute text-center&gt;\n          {LOCALE.previewLoading}...\n        &lt;/span&gt;}\n      &lt;img src={src} mw-100 mh-100 /&gt;\n      &lt;span ImageInfo style=\"top:0;left:0;\"&gt;\n        {name}\n        {date &amp;&amp; &lt;br/&gt;}\n        {date}\n      &lt;/span&gt;\n      &lt;span ImageInfo CloseSpan onClick={onRemove} overflow-hidden text-center&gt;✕&lt;/span&gt;\n      {!result &amp;&amp; !error &amp;&amp; progress === null &amp;&amp;\n        &lt;BottomLeft style=\"background:transparent;\" pl-0&gt;\n          &lt;a btn btn-light btn-sm onClick={this.uploadHandle}&gt;\n            {LOCALE.upload}\n          &lt;/a&gt;\n        &lt;/BottomLeft&gt;\n      }\n    &lt;/div&gt;\n  &lt;/Copy&gt;\n}</code></pre>\n\n<p>Notice <span class=\"tm2\">Image</span>, <span class=\"tm2\">btn</span>, <span class=\"tm2\">btn-light</span>, <em>etc</em>. When I could use bootstrap classes I did, and otherwise the rules come from stylesheets.</p>\n\n<pre id=\"c1d47\"><code class=\"css hljs\">.Image img {\n  border-radius: 3px;\n  transition: .5s;\n}\n.Image:hover img {\n  box-shadow: 0 0 19px 1px white;\n}</code></pre>\n\n<p>There's also an import of class names, as they will be renamed by Closure Stylesheets for production build. Front-end will simply export the names as they are (by parsing the stylesheet and extracting all classes based on <span class=\"tm\">\\.[\\w\\d-_]+</span> regex). Only lines that don't start with whitespace will be used to check for class names, so that values like <span class=\"tm\">.5rem</span> don't end up as class names. It's a hack since indentation is not required in CSS, but it is now hehe. Who doesn't indent rules. That could fail for media queries though, so need more robust strategy. Basically parsing CSS is not regex-space since it can have multiple opening <span class=\"tm\">{</span>, as in media queries</p>\n\n<pre id=\"c1d471\"><code class=\"css hljs\">@media (min-width: 500px) {\n  body {\n    color: green;\n  }\n}</code></pre>\n\n<p>So that we can't just look for what's between {} as it will match from first { to the next one, and not to the balancing one. But I've already solved that in JSX parser (it's a wonder it works). Fixed a few issues in JSX parser as well, making comments and blank properties possible. In other words, JSX received 3 new options: <span class=\"tm\">prop2class</span> for conversion of CapitalLetter properties into class name, <span class=\"tm\">classNames</span> to enable putting props into class name also, such as bootstrap prop, and <span class=\"tm\">renameMap</span> so that those names could be remapped after Closure Stylesheets did its renaming job.</p>\n\n<p><span class=\"tm\">closure-stylesheets</span> is now a package that contains API to run Closure Stylesheets. It was extracted from Splendid, but making a new package, documenting and compiling it is a bit of a chore, but I've mastered it, not much more could be automated, it's just work...</p>\n\n<p>After front-end is updated, what is left now, is to be able to build with ÀLaMode, renaming the location of imported styles into the one provided by closure. It's needed to run <em>TrapCSS</em> on the bootstrap stylesheet so that only relevant selectors can be extracted. I've done it with <em>Akashic</em> by copying and pasting bits of code into HTML file, and running the library against it and boostrap. But I think I can create a script for browser, where I'll be able to specify a selector from which to get element, feed its innerHTML to trapcss against bootstrap, and repeat the process a few times for all possible states (e.g., hovering over a button). It can have minimal UI, and help to gather all selectors across interactions. Otherwise, I think it's a really difficult problem to do it pragmatically, since classes can be computed dynamically.</p>\n\n<div class=\"b-B\">\n  <div class=\"b-yb\">\n    <p>In other words, after I've managed to finish this work on JSX classes, CSS renaming and trapping selectors, I'll have a build operation for widgets, which fits into microservices strategy of web apps, and constitutes the client-side (browser JS) development process. On the one hand, there's Idio for back-end, on the other, Closure Stylesheets and Compiler for front-end, and linked via types that are maintained in XML, and can be documented in seconds. Put together, it'll become Irio, the best professional full-stack framework for NodeJS. And based on that, we'll be able to consult marketing businesses on setting up their simple, modern infrastructure and assist in development.</p>\n  </div>\n  <div class=\"b-xq b-kC b-yb\">\n    <img class=\"ImageHolder b-t\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 991.8px) 510px,(max-width: 1199.8px) 330px,398px\" alt=\"microservices for your business\" src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='750' height='1000'/%3E\">\n    <noscript>\n      <picture>\n        <source\n          srcset=\"pages/index/img/1-576.webp 576w,pages/index/img/1-319.webp 319w,pages/index/img/1-750.webp 750w\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 991.8px) 510px,(max-width: 1199.8px) 330px,398px\"\n          type=\"image/webp\">\n        <img class=\"b-t\" onLoad=\"webploaded(this)\" alt=\"microservices for your business\" src=\"/blog/pages/index/img/1-576.JPG\" srcset=\"pages/index/img/1-576.JPG 576w,pages/index/img/1-319.JPG 319w,pages/index/img/1-750.JPG 750w\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 991.8px) 510px,(max-width: 1199.8px) 330px,398px\">\n      </picture>\n    </noscript>\n  </div>\n</div>\n\n<strong>TODO</strong>\n\n<ul>\n  <li>come up with a strategy for automated edge testing that could populate a lot of values, i.e. specify a range to test the function against. there's a term for that.</li>\n  <li>provide JSX namespace for HTMLAttributes that contains bootstrap utilities.</li>\n  <li>write a guest post for dotsucks: open source sucks.</li>\n</ul>\n\n<p class=\"SectionBreak\">\n  <a title=\"Back To Top\" href=\"#top\">\n    <img alt=\"section break\"\n      src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='13'/%3E\" data-io>\n    <noscript><img alt=\"section break\" src=\"/blog/section-breaks/1.svg\"></noscript></a>\n</p>\n\n<h2 id=\"26-feb-2020\">26 Feb 2020</h2>\n\n<p>Today was a chilled day, started with a Twitter now I know why people hang out there, it's quite fun when people crack jokes, had a go myself... If you're not joking you bring nothing to this world.</p>\n\n<p>\n  <img class=\"b-t\" alt=\"The higher we soar the smaller we appear to those who cannot fly. Seems like Nietzsche is year 1 plan in Seagulls school.\" src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='587' height='401'/%3E\" data-io>\n  <noscript>\n    <img class=\"b-t\" alt=\"The higher we soar the smaller we appear to those who cannot fly. Seems like Nietzsche is year 1 plan in Seagulls school.\" src=\"/blog/pages/index/img/twitter.png\">\n  </noscript>\n</p>\n\n<p>A person gave me 50 claps on Medium for a post on compiling Koa. What legend. The rest? I show them how to compile Node.JS packages, and people don't want to publish it on a newsletter... People's arrogance is pulsating through the screen. Light years ahead of everyone they can't even click the significance of this. But those claps made my day. I know my audience and they've made the right choice :)</p>\n\n<p>\n  <img class=\"b-t\" alt=\"Why would anyone be such a dick as not to give people 50 claps on #medium every time?\" src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='585' height='398'/%3E\" data-io>\n  <noscript>\n    <img class=\"b-t\" alt=\"Why would anyone be such a dick as not to give people 50 claps on #medium every time?\" src=\"/blog/pages/index/img/clap.gif\">\n  </noscript>\n</p>\n\n<p>From Twitter moving on to work. It's painful to get back to doing programming on a project after a break as there's a bit of anxiety of how to start but I'm glad I was procrastinating on GitHub checking open issues, on <span class=\"tm\">exif2css</span> so that got me back to the photo uploader. Started working on the <span class=\"tm\">images.artdeco.app</span> which is a microservice that can receive images and resize them, without having to install sharp on each other app that needs such functionality. I thought I could update Docker image to Node 12, but it wasn't starting since JSX wasn't being parsed properly. I thought it was because of the <span class=\"tm\">@depack/render</span> which didn't get updated but the transpilation happens in ÀLaMode and not rendering therefore I'm still not sure what happened. Upgraded <span class=\"tm\">render</span> package though to provide <span class=\"tm2\">api.xml</span> to expose the method via API, which was used later now.</p>\n\n<p>Then <em>Depack</em> also had to be updated, and static-analysis because of that Node 12 bug with <span class=\"tm\">makePromise</span> that broke pretty much all code in so many packages, but I'm getting back on track. That's the downside of compilation as it's the same as fixing package version, so that you have to go back to each package and recompile it to statically link new code which wouldn't have been the case if it was a dependency with non-fixed version.</p>\n\n<p>Started using GitHub Actions which are really awesome: 7GB memory, Windows / Linux / Mac containers? Shut Up and don't take any of my money for 2000 free minutes per month. <img alt=\"ci badge from actions\" data-io>\n <noscript><img alt=\"ci badge from actions\" src=\"/blog/pages/index/img/ci.png\"></noscript></p>\n\n<p><em>Idio</em> also then required fixing as frontend middleware dependent on the <span class=\"tm\">resolve-package</span> which was broken because of <span class=\"tm\">makepromise</span>. So I upgraded dependencies, and built it also. The actions could be good for building with Closure Compiler since they're so powerful, but I feel like I need control of my build step so that I can manually run <span class=\"tm\">yarn lib/compile</span> and <span class=\"tm\">yarn test-compile</span> to be able to fix issues. Or do I and it's just a bad habit that wastes a lot of time and could be avoided by working on a separate branch, and running a build step on master after a merge? nah. Also integrated the newly refreshed render for SSR rendering into <em>Idio</em> itself and wrote some documentation for that. <em>Documentary</em> needed an update to be able to use multiple parts from an example, e.g.,</p>\n\n<pre id=\"ccdbf\"><code class=\"javascript hljs\">import dep from 'dep'\n/* start example */\nimport Code from 'code'\n/* end example */\n\n(async () =&gt; {\n  /* start example */\n  console.log(Code.sayHi())\n  /* start example */\n})()</code></pre>\n\n<p>Also that required an update to stdlib which fixed the forks issue on Windows, because of the root path which I talked about in the previous entry. Didn't document this feature as I've stopped documenting documentary properly because there's this annoying bug with Wikis when forks do something silly and the whole documentation is generated twice which is extremely annoying but I can't figure it out.</p>\n\n<p>For dinner had <a href=\"https://www.fabfood4all.co.uk/kale-soup/\">kale carrot</a> soup with some chicken. Was ok. The soup was properly blended which is the first time I've do it like that.</p>\n\n<p>The rest of the day, spent working on the image uploader, in particular extracting only the needed bits from <span class=\"tm\">azure-storage</span> package that are required to PUT blobs on storage. In the end, I had 2 files, an understanding of Azure's REST and its signing mechanism, and cut 390 lines from yarn.lock by removing their library which is 25% of the whole dependency dept. Super happy about it. The process consisted of debugging what their client is doing and taking bits of their code. I've kind of adapted it for my own style, as the <span class=\"tm\">rqt</span> will add <span class=\"tm\">Content-Type</span> header using capital letters but signing worked for <span class=\"tm\">content-type</span> and same with <span class=\"tm\">content-length</span> however it's not important on their servers, they just want the signature to be correct. The goal is to then write an article about the image uploader to start that content rolling on <em>Medium</em> which is quite fun, and could be used to talk about <em>Idio</em>.</p>\n\n<p>\n  <img class=\"b-t\" alt=\"Removing 390 lines from yarn.lock by implementing custom rest api client for azure blob storage\" src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1048' height='642'/%3E\" data-io>\n  <noscript>\n    <img class=\"b-t\" alt=\"Removing 390 lines from yarn.lock by implementing custom rest api client for azure blob storage\" src=\"/blog/pages/index/img/debt.png\">\n  </noscript>\n</p>\n\n<strong>TODO</strong>\n\n<ul>\n  <li>ÀLaNode stopped working because I built it on Windows and the shebang ends with <span class=\"tm\">\\r</span> which breaks interpreter... The <span class=\"tm\">\\r</span> appeared because of automatic crln in git config, which basically means I need to switch it off, or run a regex on pre-publish script on windows to remove <span class=\"tm\">\\r</span>.</li>\n  <li>Find out what's going on with Documentary's forks which prevent proper compilation of its wiki.</li>\n  <li>Upload images on GitHub from image uploader, and hookup repo to GitHub Actions which will generate previews!</li>\n  <li>Extract the image rotation js code from vue gallery that actually changes the dimensions of the container when a photo is rotated.</li>\n</ul>\n\n<p class=\"SectionBreak\">\n  <a title=\"Back To Top\" href=\"#top\">\n    <img alt=\"section break\"\n      src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='13'/%3E\" data-io>\n    <noscript><img alt=\"section break\" src=\"/blog/section-breaks/2.svg\"></noscript></a>\n</p>\n\n<h2 id=\"22-feb-2020\">22 Feb 2020</h2>\n\n<p>Today was pretty intense. Started with wanted to fix failing Appveyor build for <em>Zoroaster</em>. This required looking into masks which were the reason builds were failing. From masks, I investigated forks as I initially thought that preprocessing doesn't get applied to inputs, but it wasn't the case. Instead, I added the <span class=\"tm\">normaliseOutputs</span> option to forks so that outputs are consistent across platforms (replacing <span class=\"tm\">\\n</span> with <span class=\"tm\">\\r\\n</span> on Win).</p>\n\n<p>\n  <img class=\"b-Ik b-t\" alt=\"appveyor screenshot\" data-io>\n  <noscript><img class=\"b-Ik b-t\" alt=\"appveyor screenshot\" src=\"/blog/pages/index/img/appveyor.png\"></noscript>\n</p>\n\n<p>During working on packages on windows, I cloned my Documentary widgets for the user directory, and the README wasn't compiling as JSX was failing. Therefore, found out about non-working JSX transpilation on Windows, and had to fix it. Pretty crucial so it's really good to keep a secondary Windows system for development just to make sure that the packages are truly cross-platform. JSX was fixed, and merged into ÀLaMode.</p>\n\n<p>A lot of tests in ÀLaMode and masks had to be updated to be cross-platform too. This typically involves normalising forks' outputs and snapshots outputs also. Apveyor by default will clone the repo using <span class=\"tm\">input</span> crln, but my config is <span class=\"tm\">auto</span> therefore the tests were failing for <em>Zoroaster</em>, as mask results are extracted using EOL which isn't robust. For now, the <span class=\"tm2\">auto</span> strategy is good enough, but when <span class=\"tm\">\\n</span> is encountered on Win, instead of <span class=\"tm\">\\r\\n</span>, mask will fail.</p>\n\n<p>\n  <img class=\"b-Ik b-t\" alt=\"appveyor badge\" data-io>\n  <noscript><img class=\"b-Ik b-t\" alt=\"appveyor badge\" src=\"/blog/pages/index/img/badge.png\"></noscript>\n</p>\n\n<p>Discovered a bug with FindPackageJSON also, which traverses paths up to root to find the location of a package. This was getting stuck in an infinite loop as the root was assumed to be <span class=\"tm\">/</span> which is wrong on Win (e.g., <span class=\"tm\">C:\\</span> is expected instead). This made <em>Documentary</em> as well as <em>Depack</em> freeze without any error message which isn't great. There's a very large number of Windows users therefore testing software on Win is absolutely essential. Just a few weeks ago, I was still using Node 8 and most of my packages were not working on Node 12 :facepalm: It was due to the Node's API being changes so that some functions were not accepting as many args as documented, whereas my package <span class=\"tm\">makepromise</span> was checking if too many arguments were passed, and \"Function doesn't accept that many arguments\" were thrown A LOT. That probably alienated some people from using packages, and I learned a lesson: to setup CI for Windows + test matrix for Node 8 + 12. Even if <em>I</em> stay on Node 8 on Mac, there are people who run Node 12 on Win.</p>\n\n<p>It's been known that <span class=\"tm\">console.log</span> prints a <span class=\"tm\">\\n</span> and not <em>EOL</em> after the logged string. But another interesting observation is that template strings also always print <span class=\"tm\">\\n</span> regardless of the platform:</p>\n\n<pre id=\"ccdbf1\"><code class=\"javascript hljs\">const t = `hello\nworld`</code></pre>\n\n<p>Counter-intuitive, even if the file is saved on a Windows machine, it the new line here is still <span class=\"tm\">\\n</span> and not <span class=\"tm\">\\r\\n</span>. +1 to interview questions list ;)</p>\n\n<p>A lot of time today was spent on testing readline interface as well as forks can accept inputs, and the way I was testing it before, was just by writing questions to <span class=\"tm\">process.stdout</span> and then pushing answers to <span class=\"tm\">process.stdin</span>. That was totally fine on Mac, but on Windows, it's buggy. You need to create separate readable and writable streams for each new question, otherwise Node will freeze if trying to do this through the main process's streams. It can work one time but then stop working for all next times when asking questions. I've updated <span class=\"tm2\">reloquent</span> so that a question now extends <em>ReadlineOptions</em> which means that for testing, I can be passing new streams, e.g.,</p>\n\n<pre id=\"ccdbf2\"><code class=\"javascript hljs\">import { askSingle } from 'reloquent'\nconst output = new Catchment()\nconst q = askSingle({\n  text: 'My girl, Where did you sleep last night',\n  output,\n  input: new Readable({\n    read() {\n      this.push('in the pines \\n') // =&gt; answer\n      this.push(null)\n    },\n  })\n})\n\noutput.promise // =&gt; My girl, Where did you sleep last night</code></pre>\n\n<p>This also unloads logging from the main console when writing tests. A disadvantage is that if my API for <span class=\"tm2\">reloquent</span> supported a simple string as a question, I'll be passing an object instead so that I'm not covering the string feature any more. This can result in errors. So it's good to have another tests covering simple strings, but it's impossible... The solution is to create a fork and write to its stdin via a separate process. This will ensure 100% test coverage. Likely with Zoroaster's mask testing it's really easy to do. Also <em>Documentary</em>'s forks can be used to combine this feature with documentation generation.</p>\n\n<p>\n  <img class=\"b-Ik b-t\" alt=\"vs code screenshot\" data-io>\n  <noscript><img class=\"b-Ik b-t\" alt=\"vs code screenshot\" src=\"/blog/pages/index/img/code.png\"></noscript>\n</p>\n\n<h3 id=\"todo\">TODO</h3>\n\n<li><span class=\"tm\">normaliseOutputs</span> to fully replace all newlines, as currently the regex is <span class=\"tm\">[^\\r]\\n</span> -> EOL but this doesn't work for 2 consecutive new lines like <span class=\"tm\">\\r\\n\\n</span>.</li>\n<li>Update <span class=\"tm2\">temp-context</span> to create cross-platform snapshots, as the paths are written using a system separator which is annoying and requires to update paths manually.</li>\n<li>Handle <span class=\"tm\">\\n</span> without <span class=\"tm\">\\r</span> on Windows for mask results extraction.</li>\n<li>Fix <em>Documentary</em> and <em>Depack</em> for FPJ on Windows.</li>\n\n<p class=\"SectionBreak\">\n  <a title=\"Back To Top\" href=\"#top\">\n    <img alt=\"section break\"\n      src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='9'/%3E\" data-io>\n    <noscript><img alt=\"section break\" src=\"/blog/section-breaks/3.svg\"></noscript></a>\n</p>",
  "file": "index",
  "postAjax": "(function imgPostAjax() {\n  /* eslint-env browser */\n  window['IO']()\n  window['WEBP']()\n})()"
}